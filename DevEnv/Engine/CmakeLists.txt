cmake_minimum_required(VERSION 3.22 FATAL_ERROR)
project(WSML VERSION 0.3 LANGUAGES C CXX)

set(CMAKE_C_STANDARD 20)
set(CMAKE_C_STANDARD_REQUIRED ON)
set(CMAKE_C_EXTENSIONS OFF)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

#------------------------------------------------------------------------#
# Project Shortcut-variables
#------------------------------------------------------------------------#

set(LIBRARY_SRCS
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/WSML.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/Runtime_variables.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/WIn32_Window_Manager.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/Keyboard_Win32.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/DWM_Examples.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/Keyboard.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/Window.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/Pulse.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/Win32_Time_Manager.cpp"
    "${CMAKE_CURRENT_SOURCE_DIR}/Source/WSML_Internal.cpp"
)

set(LIBRARY_HDRS
    "${CMAKE_CURRENT_SOURCE_DIR}/Include/WSML/WSML.h"
    "${CMAKE_CURRENT_SOURCE_DIR}/Include/WSML/Window.h"
    "${CMAKE_CURRENT_SOURCE_DIR}/Include/WSML/Keyboard.h"
    "${CMAKE_CURRENT_SOURCE_DIR}/Include/WSML/Pulse.h"
)

#------------------------------------------------------------------------#
# Project Shortcut-variables
#------------------------------------------------------------------------#


#------------------------------------------------------------------------#
# Project Build-Helper function
#------------------------------------------------------------------------#

build_and_export_library(${PROJECT_NAME}
  OUTPUT_DIR                    Library
  BUILD_DESTINATION_PATH        ${global_build_dir}
  VERSION                       0.3.2
  EXPORT_FLAG                   WSML_EXPORT 
  SOURCES                       ${LIBRARY_SRCS}
  HEADERS                       ${LIBRARY_HDRS}
  LINK_LIBS                     d3d11 dxgi d3dcompiler dwmapi shcore uxtheme
  PUBLIC_INCLUDES               ${CMAKE_CURRENT_SOURCE_DIR}/Include
  PRIVATE_INCLUDES              ${CMAKE_CURRENT_SOURCE_DIR}/Internal
)

#------------------------------------------------------------------------#
# Project Build-Helper function
#------------------------------------------------------------------------#

# Copy DLL (or .so/.dylib) to some folder after build
copy_library_post_build(${PROJECT_NAME} "${Client_Path}")